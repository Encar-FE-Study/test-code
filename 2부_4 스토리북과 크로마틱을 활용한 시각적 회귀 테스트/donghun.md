# 섹션 4 스토리북과 크로마틱을 활용한 시각적 회귀 테스트

> # 시각적 회귀 테스트를 위한 스토리북

- 스토리북은 TDD에 적합하지는 않다. 하지만 컴포넌트 개발의 효율성과 정확성을 높여준다.
- 시각적 회귀 테스트
  - UI의 변경사항이 발생했을 때 기존과 다른 점을 확인하고 예상치 못한 결과인 경우 결함으로 판단하여 수정한다.
  - 시각적 회귀 테스트를 하기 위해서 실제 검증하고 싶은 컴포넌트 렌더링 결과의 스냅샷이 필요하다.
  - 스냅샷을 제공해주는 스토리북을 통해 시각적 회귀 테스트의 표본으로 사용할 수 있다.
- 엔카의 공통 디자인 컴포넌트를 통해 단위 테스트 및 시각적 회귀 테스트를 진행하면 좋을 것 같다.

> # 스토리 작성하기

- CSF(Component Story Format)의 핵심 구성 요소
  - 메타데이터 ( default export)
  - 스토리 ( named export)
- play 함수
  - 사용자와의 상호작용을 시뮬레이션
  - 내부적으로 Testing Library를 통해 구현되어있음
  - DOM과 상호작용하거나, 어셜션을 통해 테스트 가능
  - 사용하려면 @storybook/addon-interactions를 설치해줘야함
  ```js
  // ../.storybook/main.js
  addons: [
    ...,
    '@storybook/addon-interactions',
  ],
  ```
  - 스토리 작성 대상
    - props를 받고 UI만 렌더링하는 컴포넌트에 적합
    - 복잡한 비지니스 로직이 있는 경우 모킹이 과해짐 -> 모킹이 과하면 정확도 및 신뢰성 저하 -> 테스트 무용지물!

> # 크로마틱을 통한 UI 테스트 자동화

- 시각적 회귀 테스트는 전문적인 도구를 사용하여 진행하는 것이 좋다.
- **일관된 환경에서 테스트가 가능하며 다양한 운영체제 및 브라우저에서 테스트할 수 있는 환경을 제공한다.**
- 변경 이력을 모두 저장하기 때문에 히스토리 관리에 유용하다.
- 크로마틱이란 (chromatic)
  - 스토리북 메인테이너들이 만든 시각적 회귀 테스트 도구
  - 스토리북, CI 연동 편리
  - 팀원들과 함께 작업하기 좋은 워크 플로우 제공
- 크로마틱 도입해도 좋을 듯 ?

  > # 크로마틱을 활용한 시각적 회귀 테스트 워크 플로우 만들기

- 시각적 회귀 테스트의 워크 플로우
  - 스토리북 작성 - 크로마틱 CI 연동 - UI 회귀 테스트 진행 - PR or Merge - 스토리북 배포
- 해당 부분 엔카에 적용하기엔 다소 부정적

> # 시각적 회귀 테스트의 한계

- 비용과 관리의 대한 부담
  - 크로마틱 유료네 ..
- 이슈 원인 파악이 힘듦
- 피드백이 느림 ( 워크 플로우가 길다, 스토리북 빌드 - 스냅샷 캡쳐 - 결과 분석 )
- CI 연동이 필수이다 ... ?

엔카 공통 디자인 컴포넌트에 적용하기 힘드려나?
스토리북 지금 개인 깃헙 토큰으로 운용되어지고 있는데 크로마틱을 사용한다면 괜찮지않을까 ?
5,000 snapshots per month... 🤔
