# 섹션 6 Cypress를 활용한 E2E 테스트 작성하기

## 커스텀 커맨드와 쿼리
- 커스텀 쿼리
  - retry-ability O
  - 동기로 동작하며, subject 결과를 받아 내부적으로 체이닝 코드 재시도
- 커스텀 커맨드
  - retry-ability X
  - 비동기로 동작, 특별한 설정이 없다면 subject 받지 않음
  - cy.now()로 감싸 특정 쿼리를 호출 subject를 받아 inner function에서 쿼리(get)를 실행할 수 있음
 
## E2E 테스트 작성하기
- 특정 파일에서만 반복되는 단언이나 커맨드 별도 함수로 추상화하여 분리해두면 좋음
- 커스텀 쿼리(ex. getProductCardByIndex) .커스텀 커맨드(ex. assertUrl)
- cy.session 활용하여 쿠키, local stroage, session storage 활용하여 로그인 유지 처리

## 서버 요청 가로채기
- 테스트 도중 데이터 생성 시 삭제까지 같이 검증하는 것이 좋음
  - 삭제 어려울 경우 모킹 처리
- stubbing: 특정 네트워크 요청에 대해 미리 정해진 응답을 반환하는 것
- spying: 요청과 응답에 대한 호출 정보를 기록해 두는 것

## E2E 테스트 작성하기 - 구매 페이지
- 인덱스 대신 아이디나 이름으로 요소 검색하는게 좋음
- 외부 PG사 결제 시 stubbing 처리

## E2E 테스트의 한계
- 시간 오래걸림
  - 병렬 실행의 경우 유료 플랜, Sorry Cypress
- 외부 환경 요소의 영향이 큼
  - 백엔드의 의존성이 큼
- 디버깅이 오래걸림
  - 많은 것을 검증하는 만큼 문제찾기가 어려움
- 모바일 환경이나 특정 브라우저 지원 안함

## 테스트 더블
- 더미: 단순히 실행 시 필요한 모듈이나 함수를 빈 껍데기 형태로 만드는 것
- 스텁: 정해진 값을 반환하도록 함, 내부로직을 디테일하게 구현하지는 않음
  - 특정 네트워크 요청에 대해 미리 정해진 응답을 반환하는 것
  - 상태 기준 검증
- 스파이: 객체의 호출 정보까지 기록, 함수 호출 횟수나 인자를 검증
  - 스텁을 고도화
  - 요청과 응답에 대한 호출정보를 기록
- 목: 실제 모듈과 거의 동일하게 구현, 추상화된 모의객체
  - 기대되는 예상 동작에 대한 구현을 완료한 것
  - 행동 기반 검증
- 페이크: 테스트 전용으로 만든 단순한 모듈로 대체


