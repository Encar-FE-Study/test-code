# Cypress를 활용한 E2E 테스트 작성하기

> # 커스텀 커맨드와 쿼리

- 반복되는 로직을 커스텀 커맨드와 커스텀 쿼리로 정의하여 사용할 수 있음
- 커스텀 쿼리
  - Retry-ability 지원
  - 동기로 동작하며, subject 결과를 받아 내부적으로 체이닝 코드를 일정시간 재시도
  - Cypress.Commands.addQuery()와 Cypress.Commands.overwriteQuery()로 정의
- 커스텀 커맨드
  - Retry-ability 미지원
  - 비동기로 동작할 수 있으며, 특별한 설정이 없다면 subject를 이어받지 않는다.
  - Cypress.Commands.add()와 Cypress.Commands.overwrite()로 정의

> # 서버 요청 가로채기

- 회원가입과 같이 한번 테스트한 뒤 동일한 조건으로 테스트가 어려운 경우 가입과 탈퇴의 시나리오를 한 번에 진행하는 것이 좋다.
- cy.intercept 를 사용하여 네트워크 요청을 가로챌 수 있다.
- 데이터 삭제가 어려운 경우 모킹하여 실제 데이터가 생성되지 않도록 하는 것이 좋다
- E2E 테스트에서 모킹이 유용한 경우
  - 워크플로우 실행 중 실패 케이스 검증
  - 워크플로우 내 서드파티 API나 외부 앱을 사용하는 경우

> # E2E 테스트 작성하기 - 구매 페이지

- 사전 작업이 필요한 테스트의 경우 커스텀 커맨드 및 쿼리로 간소화가 가능하다
- 실제 적용할 때는 인덱스 대신 아이디나 이름으로 요소를 검색해야함
- cy.findAllByRole('table').eq(0).findAllByRole('row').as('shippingList')
  - 요 부분 추상화하여 사용하면 안되는건가?
  - 체이닝 때문에 불가능 ?
- 테스트 환경을 만들기 어려운 경우 API 스터빙 사용

> # E2E 테스트 작성하기 - 권한 체크

- E2E 테스트로 자동화 하면 좋다
- 권한을 가진 계정만 준비되어 있다면 E2E 테스트 환경에서 빠르게 검증할 수 있음

> # E2E 테스트의 한계

- 시간이 오래 걸림
  - 직접 앱을 구동해서 테스트하기 때문에 해당 테스트까지의 시간이 오래걸리고, 시간이 오래 걸린다면 피드백이 오는 시간도 오래 걸리게 된다
  - 결국 개발 생산성이 떨어질 수 있다.
  - 병렬 실행은 쏘리 싸이프레스 ㅋㅋ
- 외부 환경 요소
  - 백엔드 의존성이 높음
  - 네트워크 의존성
  - 관리비용 올라감
- 디버깅이 오래 걸림
  - 범위가 크기 때문에 원인을 찾고, 수정하는 데 오래걸림
- 모바일 환경 및 특정 브라우저 지원 안함 ( 카카오 및 네이버 인앱 브라우저 지원 못할 듯)

> # 테스트 더블

- 더미
  - 테스트 환경에서 특정 모듈 또는 함수가 필요하지만, 실제로 해당 모듈의 구현이나 기능 실행까지는 필요 없는 경우 사용
  - 테스트 환경에서 호출만 가능하면 됨
- 스텁
  - 모듈이 호출될 때 테스트 환경에 정해진 값을 반환
  - 따라서, 정해진 경우 외에는 대응할 수 없음
- 스파이
  - 스텁 상위 호환으로서 구현된 객체의 호출 정보까지 기록한다
  - 상태 기반 검증
- 목
  - 실제 모듈과 유사한 행동을 하도록 만듦
  - 모의 객체가 모듈 사양에 맞게 동작했는지 행동 기반으로 검증
- 페이크
  - 특정 모듈을 단순한 테스트 전용 모듈로 대체
- 테스트 더블 장점
  - 실제 구현체를 사용하지 못할 때 대체 검증
  - 테스트 코드와 외부 의존성 분리
  - 예외처리 재현
