# 5.1 E2E 테스트란 무엇일까?

- 실제 앱을 실행해 시작과 끝의 전체흐름을 검증하는 테스트
- 사용자 입장에서 서비스를 사용하는 시나리오를 작성하여 테스트

### E2E 테스트의 장점

- **사용자 관점에서 시나리오 완벽 테스트** 가능
- 서비스의 전반적인 상태 확인 가능
- 도입이 가능하다면 QA일정을 조금 더 줄일 수 있을듯
  - qa 테스트 케이스를 e2e 테스트의 케이스로 작성하여 자동으로 검증이 가능함

> **내부개선 같은 업무 작업 후 qa인원 할당이 어려울 경우 유용하게 사용 가능할 듯**

### 테스트 작성 시 주의할점

- 실제 서비스, 서버에 영향 또는 부하를 주지 않는지 확인 및 테스트 계정 확인 필요
- 가능한 API 모킹을 하지않고 실제 API를 사용하여 테스트하는게 중요함
  - 구매결제 과정 등 실제 api를 테스트하기 어려운 경우만 모킹 사용
- **E2E 테스트 도입에 필요한 일정 확보가 필요**
  - QA가 있는데 왜 추가일정이 필요하는지에 대한 설명이 필요할듯
- 테스트의 신뢰도를 높이기 위해 많은 노력이 필요함

### 그렇다면 단점은?

- 유지보수 비용
  - **e2e 테스트 시나리오 작성을 위한 시나리오 설계작업 및 시나리오 케이스 작성에 적지않은 시간이 필요**
    - 개발자의 관점이 아닌 전문적인 관점에서 시나리오 작업이 들어가야함
    - qa에서 작성한 테스트 시나리오를 전달받는 방식으로 해결이 가능할 수 있음 (유관부서 협의 필요)
  - e2e 테스트가 개발일정에 포함될 경우 개발일정이 늘어나 윗분들의 심기가 불편해질 수 있음
- 실제 사용자 관점의 테스트로 e2e테스트는 단위, 통합테스트보다 훨씬 신뢰도가 높아야함
  - 렌더링, api 모킹, 네트워크 지연
  - Flaky Test 문제
  - 테스트 작성 범위의 딜레마

#### Flaky Test 문제

- 동일한 코드, 동일한 환경에서 테스트를 반복 실행했을 때, 어떤 실행에서는 통과하고 어떤 실행에서는 실패하는 테스트
- 즉 테스트 코드에 문제가 없지만 실패하는 문제로 **테스트 신뢰도의 하락**을 야기함
- CI/CD 파이프라인에 연동되어 있을 경우 자동배포가 막히는 문제 발생
- Flaky Test 주 원인
  1. 비동기 처리 타이밍으로인한 렌더링 문제
  2. 랜덤 데이터 사용
  3. 외부 의존성 문제 (비교견적의 경우 auto begins 및 infotech)
- cypress 내 flaky 테스트 기록 추적 기능 존재

# 5.2 Cypress로 e2e테스트 시작하기

- 테스트 서버 혹은 로컬 서버 기준으로 e2e테스트가 가능함
  - 테스트 서버는 실제환경과 비슷하지만 느림, 로컬 서버는 빠르지만 실제환경과 다름
- head모드와 headless모드 존재
  - CI, 클라우드 환경에서는 headless 모드가 유리함

# 5.3 Cypress로 e2e테스트 작성하기

### 단위, 통합 테스트와 e2e 테스트와의 관계

- 단위, 통합테스트로 검증한 부분을 e2e테스트로 검증하는 이유는 컴포넌트 일부가 아닌 실제 앱 자체에 대한 기능을 검증하기 위함
- 통합 테스트에서 검증한 기능을 파악해서 그것을 피하며 e2e 테스트를 작성하는 것은 더 비생산적

  - 워크플로우가 클 수록 파악하는데 시간이 소요

- e2e 테스트를 작성하면 api연동도 자동으로 테스트가 가능함

# 5.4 Cypress와 쿼리

- get Api를 활용하여 alias로 선언한 요소에 접근 가능

### subject

- 테스트의 시작지점 또는 대상이 되는 요소를 의미
- 체이닝형태로 코드 작성
- 내부적으로 비동기 대기열을 활용하기 때문에 연속해서 커맨드 실행 혹은 then() api 사용함 (실행결과 전달은 yield)
- then으로 작성하면 jquery 객체로 맵핑되어 jquery 메서드를 활용하여 다양한 작업 가능

### Retry-ability

- cy.get(), cy.should() 등 잠재적으로 업데이트 가능성이 있으면 재시도를 실행하는 api
- 테스트 타이밍에 대한 고민을 해결해주는 핵심 기능임

### Retry-ability와 Flaky Test의 비동기 렌더링 문제

- 기본 4초의 timeout 설정으로 인해 비동기 이벤트가 4초 이상 걸릴경우 문제가 발생함
  - 해결책으로는 명식적으로 10초까지 늘려줘야하는데 유지보수 비용문제
- Non-query에 해당하는 명령어(ex click)는 retry 대상이 아니라 비동기 렌더링 문제 발생
  - 버튼을 클릭하는 모든 테스트 코드에 query(should('be.enabled or be.visible')) 명령어로 한번더 확인하는 로직 필요

> 단순 요소 렌더 지연문제만 retry-ability가 해결 가능하며 나머지는 추가 작업비용이 발생
