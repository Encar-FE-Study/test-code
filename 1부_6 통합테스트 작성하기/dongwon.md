# 6. 통합테스트 작성하기

## 5.1 통합 테스트 작성하기 - ProductFilter

- 카테고리 목록을 가져온 후 필드에 정보가 올바르게 렌더링
- 상품명을 수정하는 경우 setTitle이 호출
- 카테고리를 클릭할 경우, 클릭한 카테고리가 체크
- 최소, 최대 가격을 수정하면 setMinPrice, setMaxPrice가 호출

사전작업으로

store, api 모킹 하기!!

api는 msw로 모킹

## 5.2 통합 테스트 작성하기 - NavigationBar

- wish mart 텍스트 로고를 클릭할 경우 메인 페이지로 이동 (toHaveBeenNthCalledWith)

### 로그인이 안된 경우

- 로그인 버튼이 노출되며, 클릭시 로그인 페이지로 이동

### 로그인이 된 경우 (store 모킹)

- 장바구니 카트 버튼, 장바구니에 담긴 상품수가 나타남
- 회원이름으로 된 로그아웃 버튼이 노출 됨
  - 동적으로 모킹하기 (server.use())
  - server.resetHandlers로 동적 모킹 핸들러 제거
- 장바구니 카트 버튼을 누르면 장바구니 페이지로 이동
- 로그아웃 버튼을 클릭한 경우, 로그아웃 하시겠습니까? 문구가 담긴 모달 노출
  - 모달의 확인 버튼 클릭시 로그아웃, 모달 닫힘. 취소 클릭시 모달 닫힘
    (modal은 dialog라는 role을 가지고 있음)

## 5.3 통합 테스트의 한계 - 구매 페이지

- 테스트의 범위가 페이지로 커져 테스트를 위해 많은 모킹이 필요
- 구매 성공, 실패 테스트 작성 시 모킹에만 의존해 실행해야한다
- 지나치게 모킹에 의존하여 비즈니스 로직 검증
  - 구매성공, 실패 프로세스도 모킹에만 의존하여 검증
- 통합 테스트
  - 비즈니스 로직을 나누어 컴포넌트의 상호 작용을 검증하기 좋음

이를 위해 e2e 테스트가 필요함 => 모킹에 의존하지 않고 워크플로우를 검증할 수 있음

통합 테스트와 e2e 테스트의 구분 조건이 중요

## 5.4 Github Actions을 통한 테스트 자동화

빌드, 테스트 및 배포 파이프라인을 자동화 할 수 있는 지속적 통합 및 지속적 배포(CI/CD) 플랫폼

레포지토리에 워크플로우를 생성하고 나만의 빌드, 테스트, 배포를 자동화 할 수 있다

## 5.5 1부를 마무리하며

- 테스트란?

앱의 품질과 안정성을 높이기 위해 사전에 결함을 찾아내고 수정하기 위한 일련의 행위

- 테스트 코드의 효과

  - 리펙토링: 거대한 범위의 리펙토링도 안정성 있게 진행할 수 있음
  - 문서: 테스트 코드는 앱의 이해를 돕는 좋은 문서
  - 좋은 설계: 테스트 단위에 대한 고민은 좋은 설계에 대한 사고로 이어짐

- 테스트 작성 시 중요한 규칙

  - 인터페이스 기준으로 테스트를 작성하자
    - 내부 구현에 대한 의존성이 없어야 한다
    - UI와 이벤트를 기준으로 동작을 확인하자
  - 의미있는 테스트인지 고민하자
    - 커버리지 100% 보다는 유의미한 기능을 검증할 수 있는지 확인하자
  - 테스트 코드의 가독성을 생각하자
    - 테스트의 디스크립션을 명확하게 작성하자
    - 하나의 테스트에서는 가급적 하나의 동작만 검증하자

- 무슨 테스트를 배웠을까?

  - 단위테스트: 앱에서 테스트 가능한 가장 작은 소프트웨어를 실행해 예상대로 동작하는지 확인하는 테스트
    - 공통 컴포넌트, 리액트 훅, 유틸함수: 특정 도메인에 종속되기 보다는 모듈 자체만으로 독립적으로 동작하는 모듈
  - 통합 테스트: 두 개 이상의 모듈이 상호 작용하여 발생하는 상태를 검증해 실제 앱의 비즈니스 로직과 가깝게 기능을 검증
    - 나누어진 비즈니스 로직을 기준으로 컴포넌트 조합을 검증
    - 상태 관리나 API 호출은 상위 컴포넌트로 응집
      - 테스트 범위를 나누고 코드를 관리하기 좋음

- 그 과정에서 무엇을 배웠을까?
  - Vitest
  - 단언
  - 매처
  - setup, Teardown
  - Testing Library
  - 모킹과 msw

테스트의 장단점이 있으므로 이를 이해하고 효율적이고 장기적인 운영방식으로 테스트를 설계해야함!!

그에 따라오는 신뢰감
